# Docling 매뉴얼/코드 전면 재검토 보고서 (2026-02-15)

## 검토 범위
- `docs/Docling 변환 프로그램 메뉴얼_2602150743.md`의 기획/설치/코드 블록
- 저장소 내 문서 엔트리(`README.md`, `docs/manual.md`)의 정합성

## 핵심 결론
현재 저장소는 **실행 가능한 프로젝트 구조가 아니라 대형 단일 매뉴얼 중심 상태**입니다. 특히 3장 코드가 Markdown 이스케이프(`\_`, `\*`)가 섞인 텍스트라서 그대로는 파이썬 실행 파일로 사용하기 어렵습니다. 따라서 우선순위는 기능 추가가 아니라 **재현 가능한 소스 구조 복원 + 문서 신뢰도 회복**입니다.

## 주요 문제점

### 1) 실행 자산 부재 (Repo 구성 불일치)
- 저장소 루트에는 사실상 `README.md` 제목 한 줄만 존재하며 실행/설치/테스트 진입점이 없습니다.
- `docs/manual.md`도 실제 매뉴얼이 아니라 `files` 한 줄입니다.
- 결과적으로 사용자는 매뉴얼의 “제3장 코드 복붙” 방식에만 의존해야 합니다.

### 2) 매뉴얼 내 코드 블록의 실행 가능성 저하
- 3장 코드 구간이 Markdown 이스케이프 문법(예: `\_\_init\_\_`, `\#`)이 포함된 형태로 저장되어 있어 파이썬 소스로 직접 사용 시 파싱 오류 위험이 큽니다.
- 매뉴얼은 설치 관리자 “표준 라이브러리만 사용”을 강조하지만, 실제 내장 문자열 `RUNNER_SOURCE`는 외부 패키지(`psutil`, `docling`, `torch`)에 강결합됩니다.

### 3) 배포/설치 신뢰성 리스크
- Python 다운로드 링크가 공식 URL 직접 링크가 아니라 Google 검색 URL로 연결되어 재현성·신뢰성이 낮습니다.
- `subprocess.Popen(..., shell=True)`가 리스트 인자와 혼용되어 있으며, 플랫폼/쉘별 해석 차이로 설치 실패를 유발할 수 있습니다.
- 대용량 패키지 설치(`torch`, `docling`) 실패 시 재시도/백오프/오프라인 미러 전략이 없어 현장 설치 안정성이 낮습니다.

### 4) 오류 은닉 패턴 과다
- 코드 전반에 `except: pass`가 다수 존재해 실제 장애 원인을 숨기고, 복구 로직의 품질을 떨어뜨립니다.
- 이 패턴은 “자동 재시작/무중단” 컨셉과 결합될 때 무한 재시작 루프 + 원인 미식별로 이어질 수 있습니다.

### 5) 문서-코드 히스토리 정합성 약화
- 제1장 버전 이력과 `HISTORY_TEXT`가 완전히 동일하지 않으며(예: `v35.1` 존재 여부), 장기적으로 신뢰 가능한 변경 이력으로 쓰기 어렵습니다.
- “역할/파트별 파일 분리” 원칙을 선언했지만 실제 구현은 거대한 문자열(`RUNNER_SOURCE`) 단일 파일 생성 방식으로 상충됩니다.

## 개선 제안 (우선순위)

### P0 (즉시)
1. **소스 코드 분리 복원**
   - `install_manager.pyw` / `runner_app.pyw`를 실제 파일로 분리 저장.
   - 매뉴얼은 코드 전문 대신 “버전 고정 릴리스 아티팩트 링크 + 핵심 사용법”으로 축소.
2. **문서 진입점 정상화**
   - `README.md`에 설치 요건, 실행 방법, 문제해결 섹션 추가.
   - `docs/manual.md`를 실제 목차 문서로 교체하고 상세 매뉴얼 링크 연결.
3. **예외 처리 개선**
   - `except: pass`를 `except Exception as e: logger.exception(...)`로 단계적으로 대체.

### P1 (단기)
1. **설치 안정화**
   - `shell=False` 기본 원칙, 명령 실패 시 코드/표준오류 수집.
   - 네트워크 실패 재시도(지수 백오프), CUDA/CPU 설치 분기.
2. **운영 가시성 강화**
   - 설치/실행 로그를 파일로 영속화(`logs/installer.log`, `logs/runtime.log`).
   - 자동 재시작 횟수 제한 + 쿨다운 + 사용자 알림 도입.
3. **버전/이력 단일화**
   - `CHANGELOG.md`를 단일 진실원(SSOT)으로 사용하고 UI 히스토리는 해당 파일에서 로딩.

### P2 (중기)
1. **테스트 체계 도입**
   - 최소 smoke test: 설정 저장/복원, 토큰 생성/정리, 경로 유효성 검사.
2. **배포 방식 개선**
   - PyInstaller 혹은 zipapp 기반 배포 검토(복붙 설치 방식 탈피).
3. **보안/무결성 검증**
   - 설치 패키지 해시 검증, 의존성 버전 고정(`requirements.lock`) 도입.

## 권장 목표 아키텍처
- `src/installer/` : 설치 GUI, venv/의존성 설치 모듈
- `src/runner/` : 변환 실행 GUI, 작업 큐/복구/로그
- `src/common/` : 설정/로그/유틸 공통 모듈
- `tests/` : 핵심 복구 로직 및 설정 I/O 테스트
- `docs/` : 사용자 가이드 + 운영자 가이드 + 트러블슈팅

## 빠른 실행 체크리스트
- [ ] README에 “5분 Quick Start” 작성
- [ ] Google 검색 링크를 공식 배포 URL로 교체
- [ ] `except: pass` 제거 계획표 작성(우선순위 20개)
- [ ] 코드 블록 이스케이프 제거 후 실제 `.pyw` 파일 커밋
- [ ] 설치 실패 로그 저장/출력 기능 추가
