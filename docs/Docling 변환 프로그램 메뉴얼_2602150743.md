# Docling 변환 프로그램 매뉴얼 (최종본)

- 문서 버전: **v43.0 (2026-02-15)**
- 대상: Docling 기반 PDF → 텍스트 데이터셋 변환 시스템 구축/운영 담당자
- 목적: 기존 매뉴얼의 검토 이슈(실행 불가능한 이스케이프 코드, 설치 신뢰성 부족, 예외 은닉, 이력 불일치)를 반영한 **실행 가능한 운영 표준** 제공

---

## 1) 시스템 개요

본 시스템은 기구 설계 PDF 문서를 LLM 학습용 텍스트로 변환하는 ETL 도구입니다.

핵심 목표:
1. 재현 가능한 설치
2. 장애 발생 시 원인 추적 가능한 로그
3. 재시작/복구 정책의 명확한 제어
4. 문서와 실제 동작의 일치

> 중요: 설치 GUI는 표준 라이브러리로만 동작할 수 있으나, 실행 엔진은 `docling`, `torch`, `psutil` 같은 외부 패키지에 의존합니다.

---

## 2) 이번 최종 개정에서 반영한 사항

### A. 문서 신뢰성
- 기존 “코드 복붙 설치” 중심 지침을 제거하고, 실제 파일 단위 운영 원칙으로 변경
- Google 검색 링크 제거, 공식 배포 URL 사용
- 버전/이력은 문서 본문 요약 + 별도 변경이력 파일(`CHANGELOG.md`) 관리 권장

### B. 설치/운영 안정성
- `shell=True` 남용 금지 (`subprocess.run([...], shell=False, check=True)` 권장)
- `except: pass` 금지 (`except Exception as e` + 로그 기록 필수)
- 자동 재시작은 **횟수 제한 + 쿨다운** 정책 적용 권장

### C. 구조 표준화
- 설치기/실행기/공통 모듈 분리
- 로그 파일 영속화 (`logs/installer.log`, `logs/runtime.log`)

---

## 3) 권장 프로젝트 구조 (최종)

```text
Docling/
├─ README.md
├─ CHANGELOG.md
├─ requirements.lock
├─ src/
│  ├─ installer/
│  │  └─ install_manager.pyw
│  ├─ runner/
│  │  └─ runner_app.pyw
│  └─ common/
│     ├─ config.py
│     ├─ logging_utils.py
│     └─ recovery.py
├─ logs/
├─ tests/
│  ├─ test_config.py
│  └─ test_recovery.py
└─ docs/
   └─ Docling 변환 프로그램 메뉴얼_2602150743.md
```

---

## 4) 설치 가이드 (수정 완료)

### 4.1 사전 준비
1. Python 3.12.x 설치
   - 공식 URL: `https://www.python.org/downloads/windows/`
   - 설치 시 **Add python.exe to PATH** 체크
2. 인터넷 연결 및 디스크 여유 공간 확인
3. GPU 사용 시 NVIDIA 드라이버/CUDA 호환성 사전 확인

### 4.2 가상환경 생성
```bash
python -m venv .venv
.venv\Scripts\activate
python -m pip install --upgrade pip
```

### 4.3 의존성 설치 (권장 순서)
```bash
pip install psutil pillow
pip install docling
# GPU 필요 시, 환경에 맞는 torch 설치 인덱스 사용
```

> 운영 환경별로 `requirements.lock`를 고정하여 재현성을 확보합니다.

---

## 5) 실행 가이드

1. 입력 폴더(원본 PDF)와 출력 폴더 지정
2. 옵션 설정
   - 강제 OCR
   - 병렬 처리(리소스 상황에 맞춤)
   - 자동 재시작(권장: 기본 OFF, 운영 정책 승인 후 ON)
3. 변환 시작
4. 완료 후 `report_manifest.csv`와 로그 확인

---

## 6) 필수 운영 정책

### 6.1 예외 처리 정책
- 금지: `except: pass`
- 필수:
```python
try:
    ...
except Exception as e:
    logger.exception("작업 실패: %s", e)
    raise
```

### 6.2 프로세스 호출 정책
- 금지: 리스트 인자 + `shell=True` 혼용
- 권장:
```python
subprocess.run([python_exe, "-m", "venv", venv_dir], check=True, shell=False)
```

### 6.3 자동 재시작 정책
- 최대 재시작 횟수(예: 3회)
- 재시도 간격(예: 5초, 15초, 30초)
- 초과 시 중지 후 사용자 알림

---

## 7) 검증 체크리스트

- [ ] 설치기가 표준 라이브러리만으로 기동되는가?
- [ ] 실행기 의존성 설치 실패 시 원인 로그가 남는가?
- [ ] `except: pass`가 코드베이스에 남아있지 않은가?
- [ ] `shell=True`가 필요한 특별한 근거가 있는가?
- [ ] 자동 재시작 루프 방지 제한이 적용되었는가?
- [ ] 문서의 설치 절차와 실제 실행 절차가 일치하는가?

---

## 8) 장애 대응 (요약)

### 설치가 무반응일 때
- Python 연결 프로그램 확인
- PATH 등록 확인
- 설치 로그(`logs/installer.log`) 확인

### 변환 중 반복 크래시
- 자동 재시작 횟수 제한 동작 여부 확인
- 직전 실패 파일/옵션/메모리 사용량 확인
- GPU 옵션 OFF 후 재실행으로 원인 분리

### 결과 품질 저하
- 강제 OCR 옵션/스케일 조정
- 문제 PDF를 격리 후 재처리 큐에서 분리

---

## 9) 버전 이력 (요약)

- v43.0: 매뉴얼 전면 정리(검토사항 반영 완료), 운영 표준/정책화
- v42.1: 설치기 표준 라이브러리화(무반응 이슈 대응)
- v42.0 이하: 기존 기능 이력은 별도 변경이력으로 관리 권장

---

## 10) 결론

이 최종본은 “한 파일 복붙형 매뉴얼”이 아닌, **재현 가능한 설치·운영 기준 문서**를 목표로 정리되었습니다.
다음 단계는 실제 코드 저장소(`src/installer`, `src/runner`, `src/common`)로 분리 반영하여 문서와 구현을 1:1로 일치시키는 것입니다.
